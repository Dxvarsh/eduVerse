<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- tailwind cdn -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Icon pack -->
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css"
      rel="stylesheet"
    />
    <!-- custom css -->
    <link rel="stylesheet" href="../main.css" />

    <!-- logo -->
    <link rel="shortcut icon" href="./img/evLOGO.png" type="image/x-icon" />
    <title>eduVerse | Register</title>
  </head>
  <body class="bg-darkblue w-full h-screen font-gilroy">
    <div class="flex gap-2 justify-center items-center loader-main bg-darkblue h-screen flex-col hidden">
      <div class="flex space-x-2">
          <div class="h-5 w-5 bg-[#38bdf8] rounded-full animate-bounce [animation-delay:-0.3s]"></div>
          <div class="h-5 w-5 bg-[#38bdf8] rounded-full animate-bounce [animation-delay:-0.15s]"></div>
          <div class="h-5 w-5 bg-[#38bdf8] rounded-full animate-bounce"></div>
      </div>
      <div class="flex flex-col items-center">
          <span class="text-xl leading-9 font-extrabold text-white">Loading...</span>
          <span class="text-white text-xs">(It will take time, couse our server is not like 
              <span class="text-[#1976D2] font-semibold">G</span>
              <span class="text-[#FF3D00] font-semibold -ml-0.5">O</span>
              <span class="text-[#FFC107] font-semibold -ml-0.5">O</span>
              <span class="text-[#1976D2] font-semibold -ml-0.5">G</span>
              <span class="text-[#4CAF50] font-semibold -ml-0.5">L</span>
              <span class="text-[#1976D2] font-semibold -ml-0.5">E</span>
          .🥲)</span>
      </div>
 </div>

    <div class="main h-screen w-full relative">
      <!-- navbar -->
      <nav
        class="px-3 h-20 border-b-2 border-tailblue flex items-center z-20 justify-between md:px-16 fixed right-0 left-0 backdrop-blur-md"
      >
        <div>
          <a
            href="./home.html"
            class="text-white font-bold text-xl hover:text-tailblue transition-all"
          >
            <span class="hidden md:block">Home</span>
            <i class="ri-home-line text-2xl md:hidden"></i>
          </a>
        </div>

        <div class="h-full flex items-center">
          <a class="text-white font-monument text-2xl" href="./index.html"
            ><span class="text-tailblue">edu</span>Verse</a
          >
        </div>

        <div>
          <a
            href="../index.html"
            class="text-white font-bold text-xl hover:text-tailblue transition-all"
          >
            <span class="hidden md:block">About Us</span>
            <i class="ri-information-line text-2xl md:hidden"></i>
          </a>
        </div>
      </nav>

      <main class="h-screen px-3 md:px-16 pt-20">
        <div class="min-h-screen flex flex-col justify-center py-12 sm:px-6 lg:px-8">
          <div class="sm:mx-auto sm:w-full sm:max-w-md">
              <img class="mx-auto h-10 w-auto" src="/src/img/evLOGO.png" alt="Workflow">
              <h2 class="mt-6 text-center text-3xl leading-9 font-extrabold text-white">
                  Create a new account
              </h2>
              <p class="mt-2 text-center text-sm leading-5 text-zinc-400 max-w">
                  Or
                  <a href="/src/login.html"
                      class="font-medium text-tailblue hover:text-blue-500 focus:outline-none focus:underline transition ease-in-out duration-150">
                      login to your account
                  </a>
              </p>
          </div>
      
          <div class="mt-8 sm:mx-auto bg-transparent sm:w-full sm:max-w-md">
              <div class="py-8 px-4 shadow sm:rounded-lg sm:px-10">
                  <form method="POST" action="">
                      <div>
                          <label for="username" class="block text-sm font-medium leading-5  text-tailblue">Username</label>
                          <div class="mt-1 relative rounded-md shadow-sm">
                              <input id="username" name="username" placeholder="🆔 Must be 6 characters long!" type="text" required=""
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:shadow-outline-blue focus:border-blue-300 transition duration-150 ease-in-out sm:text-sm">
                          </div>
                      </div>
      
                      <div class="mt-6">
                          <label for="fullname" class="block text-sm font-medium leading-5 text-tailblue">Full Name</label>
                          <div class="mt-1 flex rounded-md shadow-sm">
                              <input id="fullname" name="fullname" placeholder="🔤 Must be 8 characters long!" type="text" required=""
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:shadow-outline-blue focus:border-blue-300 transition duration-150 ease-in-out sm:text-sm">
                          </div>
                      </div>
      
                      <div class="mt-6">
                          <label for="email" class="block text-sm font-medium leading-5 text-tailblue">
                              Email address
                          </label>
                          <div class="mt-1 relative rounded-md shadow-sm">
                              <input id="email" name="email" placeholder="📧 user@example.com" type="email"
                                  required=""
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:shadow-outline-blue focus:border-blue-300 transition duration-150 ease-in-out sm:text-sm">
                          </div>
                      </div>
      
                      <div class="mt-6">
                        <label for="password" class="block text-sm font-medium leading-5 text-tailblue">
                          Password
                        </label>
                        <div class="mt-1 relative rounded-md shadow-sm">
                          <input
                            id="password"
                            name="password"
                            type="password"
                            required=""
                            placeholder="⚠️ Must be 8 characters long!"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:shadow-outline-blue focus:border-blue-300 transition duration-150 ease-in-out sm:text-sm"
                          />
                          <button
                            type="button"
                            id="togglePassword"
                            class="absolute inset-y-0 right-0 pr-3 flex items-center"
                          >
                            <i id="toggleIcon" class="ri-eye-line"></i> <!-- Default icon for password hidden -->
                          </button>
                        </div>
                      </div>
                      
      
                      <div class="mt-6">
                          <label for="password_confirmation" class="block text-sm font-medium leading-5 text-tailblue">
                              Confirm Password
                          </label>
                          <div class="mt-1 rounded-md shadow-sm">
                              <input id="password_confirmation" type="text" required="" placeholder="🔐 Re-enter your secret code"
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:shadow-outline-blue focus:border-blue-300 transition duration-150 ease-in-out sm:text-sm">
                          </div>
                      </div>
      
                      <div class="mt-6">
                          <label for="otp-box" class="block text-sm font-medium leading-5 text-tailblue">OTP</label>
                          <div class="mt-1 flex rounded-md shadow-sm">
                              <input id="otp-box" name="otp-box" placeholder="📲 Enter OTP" type="text" required=""
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:shadow-outline-blue focus:border-blue-300 transition duration-150 ease-in-out sm:text-sm">
                          </div>
                      </div>

                      <div
                        id="clicked"
                        class="flex flex-col justify-center items-center gap-2"
                      ></div>
      
                      <div class="mt-6">
                          <span class="block w-full rounded-md shadow-sm">
                              <button type="button" id="otp-btn"
                                  class="w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-[#38bdf8] hover:bg-blue-500 focus:outline-none focus:shadow-outline-indigo active:bg-[#38bdf8] transition duration-150 ease-in-out">
                                  Send OTP
                              </button>
                          </span>
                      </div>
      
                      <div class="mt-6">
                          <span class="hidden w-full rounded-md shadow-sm">
                              <button type="button" id="signup-submit"
                                  class="w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-[#38bdf8] hover:bg-blue-500 focus:outline-none focus:shadow-outline-indigo active:bg-[#38bdf8] transition duration-150 ease-in-out">
                                  Create account
                              </button>
                          </span>
                      </div>
                  </form>
              </div>
          </div>
        </div>
      </main>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const clickedElement = document.getElementById("clicked");
        const otpButton = document.querySelector("#otp-btn");
        const signupButton = document.querySelector("#signup-submit");
        const loader = document.querySelector(".loader-main");
        const main = document.querySelector("main");
        const otpBox = document.querySelector('#otp-box')
        const togglePasswordButton = document.getElementById("togglePassword");
        const passwordInput = document.getElementById("password");
        const toggleIcon = document.getElementById("toggleIcon");

        // Initialize state 
        signupButton.classList.add("hidden");
        otpButton.classList.add("block");

        togglePasswordButton.addEventListener("click", () => {
          const type = passwordInput.getAttribute("type") === "password" ? "text" : "password";
          passwordInput.setAttribute("type", type);

          // Toggle the icon
          if (type === "password") {
            toggleIcon.classList.remove("ri-eye-off-line");
            toggleIcon.classList.add("ri-eye-line");
          } else {
            toggleIcon.classList.remove("ri-eye-line");
            toggleIcon.classList.add("ri-eye-off-line");
          }
        });

        const showLoader = () => {
          loader.classList.remove("hidden");
          main.classList.add("hidden");
        };

        const hideLoader = () => {
          loader.classList.add("hidden");
          main.classList.remove("hidden");
        };

        
        const displayMessage = (message, isError = false) => {
          clickedElement.innerHTML = `
              <h2 class="text-white text-md ${
                isError ? "text-red-400" : "text-green-400"
              }">${message}</h2>
            `;
          setTimeout(() => {
            clickedElement.innerHTML = "";
          }, 5000);
        };

        const sendOTP = () => {
          showLoader();
          const userOtp = document.querySelector("#otp-box").value;

          fetch("https://eduversebackend-hd6t.onrender.com/api/v1/otp", {
            method: "POST",
            credentials: "include",
            body: JSON.stringify({ otp: userOtp }),
            headers: {
              "Content-Type": "application/json",
            },
          })
            .then((res) => res.json())
            .then((data) => {
              hideLoader();
              window.location.replace("./login.html");
            })
            .catch((error) => {
              hideLoader();
              console.error("Error:", error);
              displayMessage(error.message, true);
            });
        };

        otpButton.addEventListener("click", (e) => {
          e.preventDefault();
          otpBox.classList.remove("hidden");
          showLoader();

          const username = document.querySelector("#username").value;
          const fullname = document.querySelector("#fullname").value;
          const email = document.querySelector("#email").value;
          const password = document.querySelector("#password").value;
          const confirm_password = document.querySelector("#password_confirmation").value;


          if(password === confirm_password){

            fetch("https://eduversebackend-hd6t.onrender.com/api/v1/signup", {
              method: "POST",
              credentials: "include",
              body: JSON.stringify({
                fullname: fullname,
                username: username,
                password: password,
                email: email,
              }),
              headers: {
                "Content-Type": "application/json",
              },
            })
            .then((response) => response.json())
            .then((data) => {
              hideLoader();
              if (data.status_code === 200) {
                displayMessage(data.message || "Signup successful!");
                signupButton.classList.remove("hidden");
                otpButton.classList.add("hidden");
              } else {
                displayMessage(data.message || "An error occurred", true);
              }
            })
            .catch((error) => {
              hideLoader();
              console.error("Error:", error);
              displayMessage(error.message || "An error occurred", true);
            });
          }
          else{
            hideLoader();
            displayMessage("⚠️ Passwords do not match. Please re-enter", true);
            return;
          }  
        });
        hideLoader();
        signupButton.addEventListener("click", (e) => {
          e.preventDefault();
          sendOTP();
        });
      });
    </script>
  </body>
</html>
