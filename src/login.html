<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- tailwind cdn -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Icon pack -->
    <link
        href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css"
        rel="stylesheet"
    />
    <!-- custom css -->
    <link rel="stylesheet" href="../main.css">

    <!-- logo -->
    <link rel="shortcut icon" href="./src/assets/img/evLOGO.png" type="image/x-icon">
    <title>eduVerse | Log in</title>
</head>
<body class="bg-darkblue w-full h-screen font-gilroy">

    <div class="flex z-50 gap-2 justify-center items-center loader-main bg-darkblue h-screen flex-col hidden">
        <div class="flex space-x-2">
            <div class="h-5 w-5 bg-[#38bdf8] rounded-full animate-bounce [animation-delay:-0.3s]"></div>
            <div class="h-5 w-5 bg-[#38bdf8] rounded-full animate-bounce [animation-delay:-0.15s]"></div>
            <div class="h-5 w-5 bg-[#38bdf8] rounded-full animate-bounce"></div>
        </div>
        <div class="flex flex-col items-center">
            <span class="text-xl leading-9 font-extrabold text-white">Loading...</span>
            <span class="text-white text-xs">(It will take time, couse our server is not like 
                <span class="text-[#1976D2] font-semibold">G</span>
                <span class="text-[#FF3D00] font-semibold -ml-0.5">O</span>
                <span class="text-[#FFC107] font-semibold -ml-0.5">O</span>
                <span class="text-[#1976D2] font-semibold -ml-0.5">G</span>
                <span class="text-[#4CAF50] font-semibold -ml-0.5">L</span>
                <span class="text-[#1976D2] font-semibold -ml-0.5">E</span>
            .🥲)</span>
        </div>
    </div>


    <div class="main h-screen w-full relative"> 

        <!-- navbar -->
        <nav class="px-3 h-20 border-b-2 border-tailblue flex items-center justify-between md:px-16 fixed right-0 left-0 backdrop-blur-md">
            <div>
                <a href="./home.html" class="text-white font-bold text-xl hover:text-tailblue transition-all">
                    <span class="hidden md:block">Home</span> 
                    <i class="ri-home-line text-2xl md:hidden"></i>
                </a>
            </div>

            <div class="h-full flex items-center">
                <a class="text-white font-monument text-2xl" href="./index.html"><span class="text-tailblue">edu</span>Verse</a>
            </div>

            <div>
                <a href="../index.html" class="text-white font-bold text-xl hover:text-tailblue transition-all">
                    <span class="hidden md:block">About Us</span>
                    <i class="ri-information-line text-2xl md:hidden"></i>
                </a>
            </div>
        </nav>

        <main class="h-screen px-3 md:px-16">
        
            <div class="min-h-screen flex flex-col justify-center py-5 sm:px-6 lg:px-8">
                <div class="sm:mx-auto sm:w-full sm:max-w-md">
                    <img class="mx-auto h-10 w-auto" src="/src/img/evLOGO.png" alt="Workflow">
                    <h2 class="mt-6 text-center text-3xl leading-9 font-extrabold text-white">
                        Welcome back to <span class="text-tailblue">edu</span>Verse.
                    </h2>
                    <p class="mt-2 text-center text-sm leading-5 text-zinc-400 max-w">
                        Don't have an account?
                        <a href="/src/signup.html"
                            class="font-medium text-white hover:bg-blue-500 focus:outline-none focus:underline transition ease-in-out duration-150 px-4 py-1 bg-[#38bdf8] rounded-full">
                            Sign Up.
                        </a>
                    </p>
                </div>
            
                <div class="sm:mx-auto bg-transparent sm:w-full sm:max-w-md">
                    <div class="py-8 px-4 shadow sm:rounded-lg sm:px-10">
                        <form method="POST" action="">
                            <div>
                                <label for="username" class="block text-sm font-medium leading-5  text-tailblue">Username</label>
                                <div class="mt-1 relative rounded-md shadow-sm">
                                    <input id="username" name="username" placeholder="🆔 Enter Username" type="text" required=""
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:shadow-outline-blue focus:border-blue-300 transition duration-150 ease-in-out sm:text-sm">
                                </div>
                            </div>
            
                            <div class="mt-6">
                              <label for="password" class="block text-sm font-medium leading-5 text-tailblue">
                                Password
                              </label>
                              <div class="mt-1 relative rounded-md shadow-sm">
                                <input
                                  id="password"
                                  name="password"
                                  type="password"
                                  required=""
                                  placeholder="⚠️ Enter Password"
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:shadow-outline-blue focus:border-blue-300 transition duration-150 ease-in-out sm:text-sm"
                                />
                                <button
                                  type="button"
                                  id="togglePassword"
                                  class="absolute inset-y-0 right-0 pr-3 flex items-center"
                                >
                                  <i id="toggleIcon" class="ri-eye-line"></i> <!-- Default icon for password hidden -->
                                </button>
                              </div>
                            </div>
      
                            <div
                              id="clicked"
                              class="flex flex-col justify-center items-center gap-2"
                            ></div>
            
                            <div class="mt-6">
                                <span class="w-full rounded-md shadow-sm">
                                    <button type="button" id="login-submit"
                                        class="w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-[#38bdf8] hover:bg-blue-500 focus:outline-none focus:shadow-outline-indigo active:bg-[#38bdf8] transition duration-150 ease-in-out">
                                        Log in
                                    </button>
                                </span>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </main>

        <footer class="px-3 h-fit py-2 border-t-2 border-tailblue flex items-center justify-center md:px-16 fixed bottom-0 right-0 left-0 backdrop-blur-md text-white flex-col text-sm">
            <p class="text-center">
                Developed by
                <span class="text-tailblue"><a href="https://github.com/Kirtanmojidra">Kirtan Mojidra</a></span>
                & <span class="text-tailblue"><a href="https://github.com/Dxvarsh">Devarsh Nagar</a></span>
            </p>
            <p class="text-center">
                Managed with 
                <i class="ri-heart-fill text-red-500"></i>
                by our great community.
            </p>
        </footer>
    </div>


    <script>
        const loader = document.querySelector(".loader-main");
        const main = document.querySelector("main")

        
        const togglePasswordButton = document.getElementById("togglePassword");
        const passwordInput = document.getElementById("password");
        const toggleIcon = document.getElementById("toggleIcon");

        console.log(passwordInput);
        

        togglePasswordButton.addEventListener("click", () => {
          const type = passwordInput.getAttribute("type") === "password" ? "text" : "password";
          passwordInput.setAttribute("type", type);

          console.log(passwordInput);
          

          // Toggle the icon
          if (type === "password") {
            toggleIcon.classList.remove("ri-eye-off-line");
            toggleIcon.classList.add("ri-eye-line");
          } else {
            toggleIcon.classList.remove("ri-eye-line");
            toggleIcon.classList.add("ri-eye-off-line");
          }
        });

        document.querySelector('#login-submit').addEventListener('click', function(e) {
            e.preventDefault();
            
            loader.classList.remove("hidden");
            main.classList.add("hidden");
            let clickedElement = document.getElementById('clicked');
            let username = document.getElementById("username").value;
            let password = document.getElementById("password").value;

            // Perform fetch request to login API
            fetch("https://eduversebackend-hd6t.onrender.com/api/v1/login", {
                method: 'POST',
                credentials: 'include',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ "username": username, "password": password })
            })
            .then(res => {
                // Check response status
                if (res.ok) {
                    clickedElement.innerHTML += `
                        <h2 class="text-white text-md text-red-300">${res.status}</h2>
                    `;
                    return res.json(); // Parse JSON response
                } else {
                    console.log(res);
                    throw new Error('Invalid username or password.'); // Throw error for non-200 status
                }
            })
            .then(data => {
                loader.classList.add("hidden");
                main.classList.remove("hidden");
                // Redirect to index.html upon successful login
                window.location.replace("./home.html");
            })
            .catch(error => {
                // Handle fetch error or login failure
                
                loader.classList.add("hidden");
                main.classList.remove("hidden");
                console.error('Error logging in:', error);
                clickedElement.innerHTML += `
                    <h2 class="text-white text-md text-red-400">${error.message}</h2>
                `;
                setTimeout(() => {
                    clickedElement.innerHTML = ''; // Clear error message after 5 seconds
                }, 5000);
            })
        });
    </script>
</body>
</html>